name: Liquibase MySQL Migration

on:
  push:
    branches: [ main ]

jobs:
  liquibase-update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Download liquibase
        run: |
          wget https://github.com/liquibase/liquibase/releases/download/v4.33.0/liquibase-4.33.0.zip
          unzip liquibase-4.33.0.zip
          rm liquibase-4.33.0.zip
          export PATH=$PATH:/opt/liquibase


      - name: Download MySQL JDBC Driver
        run: |
          mkdir -p lib
          curl -L https://repo1.maven.org/maven2/mysql/mysql-connector-j/8.0.30/mysql-connector-j-8.0.30.jar -o lib/mysql-connector-j-8.0.30.jar

      - name: Run Liquibase Update
        run: |
          liquibase \
            --classpath=lib/mysql-connector-j-8.0.30.jar \
            --url="jdbc:mysql://localhost:3300/onlinebookstore" \
            --username=root \
            --password=root \
            --changeLogFile=changelog/changelog.xml \
            update
